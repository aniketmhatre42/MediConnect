{"ast":null,"code":"var _jsxFileName = \"D:\\\\Movies\\\\Aniket\\\\test2\\\\test\\\\src\\\\Login.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport * as faceapi from 'face-api.js';\nimport './Login.css';\nimport { getAllFaceDescriptors } from './services/localFaceStorage';\nimport { findMatchingFace, formatMatchConfidence } from './utils/faceUtils';\nimport { testCameraWithConstraints } from './utils/cameraDebugger';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction Login() {\n  _s();\n  // State hooks\n  const [error, setError] = useState(null);\n  const [faceAuthStage, setFaceAuthStage] = useState('start');\n  const [cameraReady, setCameraReady] = useState(false);\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [scanProgress, setScanProgress] = useState(0);\n  const [matchConfidence, setMatchConfidence] = useState(null);\n  const [matchedUser, setMatchedUser] = useState(null);\n\n  // Refs\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const streamRef = useRef(null);\n  const detectionIntervalRef = useRef(null);\n\n  // Router hooks\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  // Set up face detection on component mount\n  useEffect(() => {\n    const loadModels = async () => {\n      try {\n        // Explicitly set the correct models path - ensure this folder exists in public\n        const MODEL_URL = '/models';\n        console.log('Loading face-api.js models from:', MODEL_URL);\n        setError(null); // Clear any previous errors\n\n        await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n        console.log('Face detection models loaded successfully');\n        setModelsLoaded(true);\n      } catch (error) {\n        console.error('Error loading face-api models:', error);\n        setError('Failed to load facial recognition models. Please check your internet connection and try again.');\n        setModelsLoaded(false);\n      }\n    };\n    loadModels();\n\n    // Clean up on unmount\n    return () => {\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n      if (detectionIntervalRef.current) {\n        clearInterval(detectionIntervalRef.current);\n      }\n    };\n  }, []);\n\n  // Add a retry mechanism for model loading\n  const retryModelLoading = () => {\n    console.log(\"Retrying model loading...\");\n    setError(null);\n    setModelsLoaded(false);\n\n    // Force reload models\n    const loadModels = async () => {\n      try {\n        const MODEL_URL = '/models';\n        console.log('Reloading face-api.js models from:', MODEL_URL);\n        await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n        console.log('Face detection models loaded successfully on retry');\n        setModelsLoaded(true);\n      } catch (error) {\n        console.error('Error reloading face-api models:', error);\n        setError('Failed to load facial recognition models. Please check your internet connection and try again.');\n        setModelsLoaded(false);\n      }\n    };\n    loadModels();\n  };\n\n  // Function to handle face authentication\n  const startFaceAuth = async () => {\n    setError(null);\n    setFaceAuthStage('scanning');\n    try {\n      // Request camera access\n      const constraints = {\n        video: {\n          width: {\n            ideal: 640\n          },\n          height: {\n            ideal: 480\n          },\n          facingMode: 'user'\n        }\n      };\n\n      // Test camera with these constraints\n      const testResult = await testCameraWithConstraints(constraints);\n      if (!testResult.success) {\n        throw new Error(`Camera access failed: ${testResult.errorMessage || 'Unknown error'}`);\n      }\n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\n      streamRef.current = stream;\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        videoRef.current.play();\n        setCameraReady(true);\n\n        // Start face detection after camera is ready\n        videoRef.current.onloadedmetadata = () => {\n          detectFaces();\n        };\n      }\n    } catch (err) {\n      console.error('Error starting camera:', err);\n      setError(`Camera access error: ${err.message || 'Unknown error'}. Please ensure your camera is connected and permissions are granted.`);\n      setFaceAuthStage('start');\n    }\n  };\n\n  // Function to detect faces\n  const detectFaces = () => {\n    if (!videoRef.current || !modelsLoaded) {\n      return;\n    }\n\n    // Clear any existing detection interval\n    if (detectionIntervalRef.current) {\n      clearInterval(detectionIntervalRef.current);\n    }\n    let detectionCount = 0;\n    const requiredDetections = 5;\n    let accumulatedDescriptor = null;\n    detectionIntervalRef.current = setInterval(async () => {\n      try {\n        if (videoRef.current && videoRef.current.readyState === 4) {\n          const detections = await faceapi.detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptor();\n          if (detections) {\n            // Update progress\n            detectionCount++;\n            const progress = Math.min(detectionCount / requiredDetections * 100, 100);\n            setScanProgress(progress);\n\n            // Accumulate descriptor for better accuracy\n            if (!accumulatedDescriptor) {\n              accumulatedDescriptor = detections.descriptor;\n            } else {\n              // Merge descriptors by averaging\n              for (let i = 0; i < 128; i++) {\n                accumulatedDescriptor[i] = (accumulatedDescriptor[i] * (detectionCount - 1) + detections.descriptor[i]) / detectionCount;\n              }\n            }\n\n            // Draw face detection on canvas if we have a canvas ref\n            if (canvasRef.current) {\n              const displaySize = {\n                width: videoRef.current.width,\n                height: videoRef.current.height\n              };\n              faceapi.matchDimensions(canvasRef.current, displaySize);\n              const resizedDetection = faceapi.resizeResults(detections, displaySize);\n              const context = canvasRef.current.getContext('2d');\n              context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n              faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\n            }\n\n            // If we have enough detections, try to match face\n            if (detectionCount >= requiredDetections) {\n              clearInterval(detectionIntervalRef.current);\n              matchFace(accumulatedDescriptor);\n            }\n          }\n        }\n      } catch (err) {\n        console.error('Face detection error:', err);\n        clearInterval(detectionIntervalRef.current);\n        setError(`Face detection error: ${err.message}`);\n        setFaceAuthStage('start');\n      }\n    }, 500);\n  };\n\n  // Function to match detected face with stored faces\n  const matchFace = async descriptor => {\n    try {\n      // Get all stored face descriptors\n      const faceData = getAllFaceDescriptors();\n      if (!faceData || faceData.length === 0) {\n        setError('No registered faces found. Please sign up first.');\n        setFaceAuthStage('start');\n        return;\n      }\n\n      // Find a match\n      const match = findMatchingFace(descriptor, faceData);\n      if (match) {\n        const {\n          user,\n          confidence\n        } = match;\n        console.log('Match found:', user.username, 'Confidence:', confidence);\n        setMatchConfidence(confidence);\n        setMatchedUser(user);\n        setFaceAuthStage('success');\n\n        // Stop video stream\n        if (streamRef.current) {\n          streamRef.current.getTracks().forEach(track => track.stop());\n        }\n\n        // After 2 seconds, redirect to home page\n        setTimeout(() => {\n          handleSuccessfulFaceLogin(user);\n        }, 2000);\n      } else {\n        setError('Face not recognized. Please try again or register if you are a new user.');\n        setFaceAuthStage('start');\n      }\n    } catch (err) {\n      console.error('Error during face matching:', err);\n      setError(`Authentication error: ${err.message}`);\n      setFaceAuthStage('start');\n    }\n  };\n\n  // Function to handle successful face login - simplified to use only username\n  const handleSuccessfulFaceLogin = matchedUser => {\n    var _location$state;\n    if (!matchedUser || !matchedUser.username) {\n      setError(\"Authentication failed. User data incomplete.\");\n      return;\n    }\n    console.log(\"Face authentication successful for:\", matchedUser.username);\n\n    // Store user session data in sessionStorage - simplified to username only\n    sessionStorage.setItem('authenticated', 'true');\n    sessionStorage.setItem('userId', matchedUser.userId || `user_${Date.now()}`);\n    sessionStorage.setItem('username', matchedUser.username);\n    sessionStorage.setItem('loginMethod', 'face');\n    sessionStorage.setItem('loginTime', new Date().toISOString());\n\n    // Optionally store some user data in localStorage for persistence\n    try {\n      localStorage.setItem('user', JSON.stringify({\n        userId: matchedUser.userId || `user_${Date.now()}`,\n        username: matchedUser.username,\n        role: 'user',\n        lastLogin: new Date().toISOString()\n      }));\n    } catch (e) {\n      console.warn(\"Could not save to localStorage:\", e);\n    }\n\n    // Use the proper location from useLocation()\n    const redirectTo = ((_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.redirectAfterLogin) || \"/\";\n    navigate(redirectTo);\n  };\n\n  // Function to cancel face auth and go back to start\n  const cancelFaceAuth = () => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n    }\n    if (detectionIntervalRef.current) {\n      clearInterval(detectionIntervalRef.current);\n    }\n    setFaceAuthStage('start');\n    setCameraReady(false);\n    setScanProgress(0);\n  };\n\n  // Function to retry face auth\n  const retryFaceAuth = () => {\n    cancelFaceAuth();\n    setTimeout(() => {\n      startFaceAuth();\n    }, 500);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"login-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"login-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Face Authentication Login\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        children: [error, /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: retryModelLoading,\n          className: \"retry-models-btn\",\n          children: \"Retry\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"face-auth-container\",\n        children: [faceAuthStage === 'start' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"login-start-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"face-icon-container\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"face-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 327,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"login-instruction\",\n            children: \"Use facial recognition to login instantly\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"start-face-auth-btn\",\n            onClick: startFaceAuth,\n            disabled: !modelsLoaded,\n            children: modelsLoaded ? 'Start Face Authentication' : 'Loading Models...'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 332,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 13\n        }, this), faceAuthStage === 'scanning' && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"video-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              playsInline: true,\n              muted: true,\n              width: \"100%\",\n              height: \"100%\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              className: \"face-canvas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 353,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"scanning-overlay\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"scanning-animation\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 356,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"scan-status\",\n                children: \"Scanning your face...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 357,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"progress-container\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"progress-bar\",\n                  style: {\n                    width: `${scanProgress}%`\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 360,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 359,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 355,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 344,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"auth-action-buttons\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"retry-button\",\n              onClick: retryFaceAuth,\n              children: \"Retry\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"cancel-button\",\n              onClick: cancelFaceAuth,\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 372,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 368,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), faceAuthStage === 'success' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"video-container\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"auth-success-overlay\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"success-checkmark\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 382,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Authentication Successful\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 383,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Welcome back, \", matchedUser === null || matchedUser === void 0 ? void 0 : matchedUser.username]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 17\n            }, this), matchConfidence && /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Match confidence: \", formatMatchConfidence(matchConfidence)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 386,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"redirect-message\",\n              children: \"Redirecting you...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 381,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 380,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"alternative-auth\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Don't have an account?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 394,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"register-face-btn\",\n            onClick: () => navigate('/signup'),\n            children: \"Register with Face ID\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 395,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 309,\n    columnNumber: 5\n  }, this);\n}\n_s(Login, \"Mdp/OdOc6HdC6Sj1Kp7WVBx4a7A=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = Login;\nexport default Login;\nvar _c;\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useLocation","faceapi","getAllFaceDescriptors","findMatchingFace","formatMatchConfidence","testCameraWithConstraints","jsxDEV","_jsxDEV","Fragment","_Fragment","Login","_s","error","setError","faceAuthStage","setFaceAuthStage","cameraReady","setCameraReady","modelsLoaded","setModelsLoaded","scanProgress","setScanProgress","matchConfidence","setMatchConfidence","matchedUser","setMatchedUser","videoRef","canvasRef","streamRef","detectionIntervalRef","navigate","location","loadModels","MODEL_URL","console","log","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","current","getTracks","forEach","track","stop","clearInterval","retryModelLoading","startFaceAuth","constraints","video","width","ideal","height","facingMode","testResult","success","Error","errorMessage","stream","navigator","mediaDevices","getUserMedia","srcObject","play","onloadedmetadata","detectFaces","err","message","detectionCount","requiredDetections","accumulatedDescriptor","setInterval","readyState","detections","detectSingleFace","TinyFaceDetectorOptions","withFaceLandmarks","withFaceDescriptor","progress","Math","min","descriptor","i","displaySize","matchDimensions","resizedDetection","resizeResults","context","getContext","clearRect","draw","drawDetections","matchFace","faceData","length","match","user","confidence","username","setTimeout","handleSuccessfulFaceLogin","_location$state","sessionStorage","setItem","userId","Date","now","toISOString","localStorage","JSON","stringify","role","lastLogin","e","warn","redirectTo","state","redirectAfterLogin","cancelFaceAuth","retryFaceAuth","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","ref","autoPlay","playsInline","muted","style","_c","$RefreshReg$"],"sources":["D:/Movies/Aniket/test2/test/src/Login.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport * as faceapi from 'face-api.js';\r\nimport './Login.css';\r\nimport { getAllFaceDescriptors } from './services/localFaceStorage';\r\nimport { findMatchingFace, formatMatchConfidence } from './utils/faceUtils';\r\nimport { testCameraWithConstraints } from './utils/cameraDebugger';\r\n\r\nfunction Login() {\r\n  // State hooks\r\n  const [error, setError] = useState(null);\r\n  const [faceAuthStage, setFaceAuthStage] = useState('start');\r\n  const [cameraReady, setCameraReady] = useState(false);\r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n  const [scanProgress, setScanProgress] = useState(0);\r\n  const [matchConfidence, setMatchConfidence] = useState(null);\r\n  const [matchedUser, setMatchedUser] = useState(null);\r\n  \r\n  // Refs\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n  const detectionIntervalRef = useRef(null);\r\n  \r\n  // Router hooks\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  \r\n  // Set up face detection on component mount\r\n  useEffect(() => {\r\n    const loadModels = async () => {\r\n      try {\r\n        // Explicitly set the correct models path - ensure this folder exists in public\r\n        const MODEL_URL = '/models';\r\n        console.log('Loading face-api.js models from:', MODEL_URL);\r\n        \r\n        setError(null); // Clear any previous errors\r\n        \r\n        await Promise.all([\r\n          faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n          faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n          faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)\r\n        ]);\r\n        \r\n        console.log('Face detection models loaded successfully');\r\n        setModelsLoaded(true);\r\n      } catch (error) {\r\n        console.error('Error loading face-api models:', error);\r\n        setError('Failed to load facial recognition models. Please check your internet connection and try again.');\r\n        setModelsLoaded(false);\r\n      }\r\n    };\r\n\r\n    loadModels();\r\n    \r\n    // Clean up on unmount\r\n    return () => {\r\n      if (streamRef.current) {\r\n        streamRef.current.getTracks().forEach(track => track.stop());\r\n      }\r\n      \r\n      if (detectionIntervalRef.current) {\r\n        clearInterval(detectionIntervalRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Add a retry mechanism for model loading\r\n  const retryModelLoading = () => {\r\n    console.log(\"Retrying model loading...\");\r\n    setError(null);\r\n    setModelsLoaded(false);\r\n    \r\n    // Force reload models\r\n    const loadModels = async () => {\r\n      try {\r\n        const MODEL_URL = '/models';\r\n        \r\n        console.log('Reloading face-api.js models from:', MODEL_URL);\r\n        \r\n        await Promise.all([\r\n          faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n          faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n          faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)\r\n        ]);\r\n        \r\n        console.log('Face detection models loaded successfully on retry');\r\n        setModelsLoaded(true);\r\n      } catch (error) {\r\n        console.error('Error reloading face-api models:', error);\r\n        setError('Failed to load facial recognition models. Please check your internet connection and try again.');\r\n        setModelsLoaded(false);\r\n      }\r\n    };\r\n    \r\n    loadModels();\r\n  };\r\n\r\n  // Function to handle face authentication\r\n  const startFaceAuth = async () => {\r\n    setError(null);\r\n    setFaceAuthStage('scanning');\r\n    \r\n    try {\r\n      // Request camera access\r\n      const constraints = {\r\n        video: {\r\n          width: { ideal: 640 },\r\n          height: { ideal: 480 },\r\n          facingMode: 'user'\r\n        }\r\n      };\r\n      \r\n      // Test camera with these constraints\r\n      const testResult = await testCameraWithConstraints(constraints);\r\n      if (!testResult.success) {\r\n        throw new Error(`Camera access failed: ${testResult.errorMessage || 'Unknown error'}`);\r\n      }\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n      streamRef.current = stream;\r\n      \r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        videoRef.current.play();\r\n        setCameraReady(true);\r\n        \r\n        // Start face detection after camera is ready\r\n        videoRef.current.onloadedmetadata = () => {\r\n          detectFaces();\r\n        };\r\n      }\r\n    } catch (err) {\r\n      console.error('Error starting camera:', err);\r\n      setError(`Camera access error: ${err.message || 'Unknown error'}. Please ensure your camera is connected and permissions are granted.`);\r\n      setFaceAuthStage('start');\r\n    }\r\n  };\r\n\r\n  // Function to detect faces\r\n  const detectFaces = () => {\r\n    if (!videoRef.current || !modelsLoaded) {\r\n      return;\r\n    }\r\n\r\n    // Clear any existing detection interval\r\n    if (detectionIntervalRef.current) {\r\n      clearInterval(detectionIntervalRef.current);\r\n    }\r\n\r\n    let detectionCount = 0;\r\n    const requiredDetections = 5;\r\n    let accumulatedDescriptor = null;\r\n\r\n    detectionIntervalRef.current = setInterval(async () => {\r\n      try {\r\n        if (videoRef.current && videoRef.current.readyState === 4) {\r\n          const detections = await faceapi.detectSingleFace(\r\n            videoRef.current, \r\n            new faceapi.TinyFaceDetectorOptions()\r\n          ).withFaceLandmarks().withFaceDescriptor();\r\n\r\n          if (detections) {\r\n            // Update progress\r\n            detectionCount++;\r\n            const progress = Math.min((detectionCount / requiredDetections) * 100, 100);\r\n            setScanProgress(progress);\r\n\r\n            // Accumulate descriptor for better accuracy\r\n            if (!accumulatedDescriptor) {\r\n              accumulatedDescriptor = detections.descriptor;\r\n            } else {\r\n              // Merge descriptors by averaging\r\n              for (let i = 0; i < 128; i++) {\r\n                accumulatedDescriptor[i] = (accumulatedDescriptor[i] * (detectionCount - 1) + detections.descriptor[i]) / detectionCount;\r\n              }\r\n            }\r\n\r\n            // Draw face detection on canvas if we have a canvas ref\r\n            if (canvasRef.current) {\r\n              const displaySize = { \r\n                width: videoRef.current.width, \r\n                height: videoRef.current.height \r\n              };\r\n              faceapi.matchDimensions(canvasRef.current, displaySize);\r\n              \r\n              const resizedDetection = faceapi.resizeResults(detections, displaySize);\r\n              const context = canvasRef.current.getContext('2d');\r\n              context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n              faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\r\n            }\r\n\r\n            // If we have enough detections, try to match face\r\n            if (detectionCount >= requiredDetections) {\r\n              clearInterval(detectionIntervalRef.current);\r\n              matchFace(accumulatedDescriptor);\r\n            }\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('Face detection error:', err);\r\n        clearInterval(detectionIntervalRef.current);\r\n        setError(`Face detection error: ${err.message}`);\r\n        setFaceAuthStage('start');\r\n      }\r\n    }, 500);\r\n  };\r\n\r\n  // Function to match detected face with stored faces\r\n  const matchFace = async (descriptor) => {\r\n    try {\r\n      // Get all stored face descriptors\r\n      const faceData = getAllFaceDescriptors();\r\n      \r\n      if (!faceData || faceData.length === 0) {\r\n        setError('No registered faces found. Please sign up first.');\r\n        setFaceAuthStage('start');\r\n        return;\r\n      }\r\n      \r\n      // Find a match\r\n      const match = findMatchingFace(descriptor, faceData);\r\n      \r\n      if (match) {\r\n        const { user, confidence } = match;\r\n        console.log('Match found:', user.username, 'Confidence:', confidence);\r\n        \r\n        setMatchConfidence(confidence);\r\n        setMatchedUser(user);\r\n        setFaceAuthStage('success');\r\n        \r\n        // Stop video stream\r\n        if (streamRef.current) {\r\n          streamRef.current.getTracks().forEach(track => track.stop());\r\n        }\r\n        \r\n        // After 2 seconds, redirect to home page\r\n        setTimeout(() => {\r\n          handleSuccessfulFaceLogin(user);\r\n        }, 2000);\r\n      } else {\r\n        setError('Face not recognized. Please try again or register if you are a new user.');\r\n        setFaceAuthStage('start');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error during face matching:', err);\r\n      setError(`Authentication error: ${err.message}`);\r\n      setFaceAuthStage('start');\r\n    }\r\n  };\r\n\r\n  // Function to handle successful face login - simplified to use only username\r\n  const handleSuccessfulFaceLogin = (matchedUser) => {\r\n    if (!matchedUser || !matchedUser.username) {\r\n      setError(\"Authentication failed. User data incomplete.\");\r\n      return;\r\n    }\r\n\r\n    console.log(\"Face authentication successful for:\", matchedUser.username);\r\n    \r\n    // Store user session data in sessionStorage - simplified to username only\r\n    sessionStorage.setItem('authenticated', 'true');\r\n    sessionStorage.setItem('userId', matchedUser.userId || `user_${Date.now()}`);\r\n    sessionStorage.setItem('username', matchedUser.username);\r\n    sessionStorage.setItem('loginMethod', 'face');\r\n    sessionStorage.setItem('loginTime', new Date().toISOString());\r\n    \r\n    // Optionally store some user data in localStorage for persistence\r\n    try {\r\n      localStorage.setItem('user', JSON.stringify({\r\n        userId: matchedUser.userId || `user_${Date.now()}`,\r\n        username: matchedUser.username,\r\n        role: 'user',\r\n        lastLogin: new Date().toISOString()\r\n      }));\r\n    } catch (e) {\r\n      console.warn(\"Could not save to localStorage:\", e);\r\n    }\r\n    \r\n    // Use the proper location from useLocation()\r\n    const redirectTo = location.state?.redirectAfterLogin || \"/\";\r\n    navigate(redirectTo);\r\n  };\r\n\r\n  // Function to cancel face auth and go back to start\r\n  const cancelFaceAuth = () => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach(track => track.stop());\r\n    }\r\n    \r\n    if (detectionIntervalRef.current) {\r\n      clearInterval(detectionIntervalRef.current);\r\n    }\r\n    \r\n    setFaceAuthStage('start');\r\n    setCameraReady(false);\r\n    setScanProgress(0);\r\n  };\r\n\r\n  // Function to retry face auth\r\n  const retryFaceAuth = () => {\r\n    cancelFaceAuth();\r\n    setTimeout(() => {\r\n      startFaceAuth();\r\n    }, 500);\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-container\">\r\n      <div className=\"login-card\">\r\n        <h2>Face Authentication Login</h2>\r\n        \r\n        {error && (\r\n          <div className=\"error-message\">\r\n            {error}\r\n            <button onClick={retryModelLoading} className=\"retry-models-btn\">\r\n              Retry\r\n            </button>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Face Authentication UI */}\r\n        <div className=\"face-auth-container\">\r\n          {faceAuthStage === 'start' && (\r\n            <div className=\"login-start-section\">\r\n              <div className=\"face-icon-container\">\r\n                <div className=\"face-icon\"></div>\r\n              </div>\r\n              <p className=\"login-instruction\">\r\n                Use facial recognition to login instantly\r\n              </p>\r\n              <button \r\n                className=\"start-face-auth-btn\"\r\n                onClick={startFaceAuth}\r\n                disabled={!modelsLoaded}\r\n              >\r\n                {modelsLoaded ? 'Start Face Authentication' : 'Loading Models...'}\r\n              </button>\r\n            </div>\r\n          )}\r\n          \r\n          {faceAuthStage === 'scanning' && (\r\n            <>\r\n              <div className=\"video-container\">\r\n                <video\r\n                  ref={videoRef}\r\n                  autoPlay\r\n                  playsInline\r\n                  muted\r\n                  width=\"100%\"\r\n                  height=\"100%\"\r\n                />\r\n                <canvas ref={canvasRef} className=\"face-canvas\" />\r\n                \r\n                <div className=\"scanning-overlay\">\r\n                  <div className=\"scanning-animation\"></div>\r\n                  <p className=\"scan-status\">Scanning your face...</p>\r\n                  \r\n                  <div className=\"progress-container\">\r\n                    <div \r\n                      className=\"progress-bar\" \r\n                      style={{ width: `${scanProgress}%` }}\r\n                    ></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"auth-action-buttons\">\r\n                <button className=\"retry-button\" onClick={retryFaceAuth}>\r\n                  Retry\r\n                </button>\r\n                <button className=\"cancel-button\" onClick={cancelFaceAuth}>\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </>\r\n          )}\r\n          \r\n          {faceAuthStage === 'success' && (\r\n            <div className=\"video-container\">\r\n              <div className=\"auth-success-overlay\">\r\n                <div className=\"success-checkmark\"></div>\r\n                <h3>Authentication Successful</h3>\r\n                <p>Welcome back, {matchedUser?.username}</p>\r\n                {matchConfidence && (\r\n                  <p>Match confidence: {formatMatchConfidence(matchConfidence)}</p>\r\n                )}\r\n                <p className=\"redirect-message\">Redirecting you...</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          <div className=\"alternative-auth\">\r\n            <p>Don't have an account?</p>\r\n            <button \r\n              className=\"register-face-btn\"\r\n              onClick={() => navigate('/signup')}\r\n            >\r\n              Register with Face ID\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Login;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}