{"ast":null,"code":"var _jsxFileName = \"D:\\\\Movies\\\\Aniket\\\\test2\\\\test\\\\src\\\\Login.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport * as faceapi from 'face-api.js';\nimport './Login.css';\nimport { getAllFaceDescriptors } from './services/localFaceStorage';\nimport { findMatchingFace, formatMatchConfidence } from './utils/faceUtils';\nimport { testCameraWithConstraints } from './utils/cameraDebugger';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction Login() {\n  _s();\n  // State hooks\n  const [error, setError] = useState(null);\n  const [faceAuthStage, setFaceAuthStage] = useState('start');\n  const [cameraReady, setCameraReady] = useState(false);\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [scanProgress, setScanProgress] = useState(0);\n  const [matchConfidence, setMatchConfidence] = useState(null);\n  const [matchedUser, setMatchedUser] = useState(null);\n\n  // Refs\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const streamRef = useRef(null);\n  const detectionIntervalRef = useRef(null);\n\n  // Router hooks\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  // Set up face detection on component mount\n  useEffect(() => {\n    const loadModels = async () => {\n      try {\n        // Set paths to models - adjust these paths according to your project structure\n        const MODEL_URL = process.env.PUBLIC_URL + '/models';\n        await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n        console.log('Face detection models loaded');\n        setModelsLoaded(true);\n      } catch (error) {\n        console.error('Error loading face-api models:', error);\n        setError('Failed to load facial recognition models. Please try again.');\n      }\n    };\n    loadModels();\n\n    // Clean up on unmount\n    return () => {\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n      if (detectionIntervalRef.current) {\n        clearInterval(detectionIntervalRef.current);\n      }\n    };\n  }, []);\n\n  // Function to handle face authentication\n  const startFaceAuth = async () => {\n    setError(null);\n    setFaceAuthStage('scanning');\n    try {\n      // Request camera access\n      const constraints = {\n        video: {\n          width: {\n            ideal: 640\n          },\n          height: {\n            ideal: 480\n          },\n          facingMode: 'user'\n        }\n      };\n\n      // Test camera with these constraints\n      const testResult = await testCameraWithConstraints(constraints);\n      if (!testResult.success) {\n        throw new Error(`Camera access failed: ${testResult.errorMessage || 'Unknown error'}`);\n      }\n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\n      streamRef.current = stream;\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        videoRef.current.play();\n        setCameraReady(true);\n\n        // Start face detection after camera is ready\n        videoRef.current.onloadedmetadata = () => {\n          detectFaces();\n        };\n      }\n    } catch (err) {\n      console.error('Error starting camera:', err);\n      setError(`Camera access error: ${err.message || 'Unknown error'}. Please ensure your camera is connected and permissions are granted.`);\n      setFaceAuthStage('start');\n    }\n  };\n\n  // Function to detect faces\n  const detectFaces = () => {\n    if (!videoRef.current || !modelsLoaded) {\n      return;\n    }\n\n    // Clear any existing detection interval\n    if (detectionIntervalRef.current) {\n      clearInterval(detectionIntervalRef.current);\n    }\n    let detectionCount = 0;\n    const requiredDetections = 5;\n    let accumulatedDescriptor = null;\n    detectionIntervalRef.current = setInterval(async () => {\n      try {\n        if (videoRef.current && videoRef.current.readyState === 4) {\n          const detections = await faceapi.detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptor();\n          if (detections) {\n            // Update progress\n            detectionCount++;\n            const progress = Math.min(detectionCount / requiredDetections * 100, 100);\n            setScanProgress(progress);\n\n            // Accumulate descriptor for better accuracy\n            if (!accumulatedDescriptor) {\n              accumulatedDescriptor = detections.descriptor;\n            } else {\n              // Merge descriptors by averaging\n              for (let i = 0; i < 128; i++) {\n                accumulatedDescriptor[i] = (accumulatedDescriptor[i] * (detectionCount - 1) + detections.descriptor[i]) / detectionCount;\n              }\n            }\n\n            // Draw face detection on canvas if we have a canvas ref\n            if (canvasRef.current) {\n              const displaySize = {\n                width: videoRef.current.width,\n                height: videoRef.current.height\n              };\n              faceapi.matchDimensions(canvasRef.current, displaySize);\n              const resizedDetection = faceapi.resizeResults(detections, displaySize);\n              const context = canvasRef.current.getContext('2d');\n              context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n              faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\n            }\n\n            // If we have enough detections, try to match face\n            if (detectionCount >= requiredDetections) {\n              clearInterval(detectionIntervalRef.current);\n              matchFace(accumulatedDescriptor);\n            }\n          }\n        }\n      } catch (err) {\n        console.error('Face detection error:', err);\n        clearInterval(detectionIntervalRef.current);\n        setError(`Face detection error: ${err.message}`);\n        setFaceAuthStage('start');\n      }\n    }, 500);\n  };\n\n  // Function to match detected face with stored faces\n  const matchFace = async descriptor => {\n    try {\n      // Get all stored face descriptors\n      const faceData = getAllFaceDescriptors();\n      if (!faceData || faceData.length === 0) {\n        setError('No registered faces found. Please sign up first.');\n        setFaceAuthStage('start');\n        return;\n      }\n\n      // Find a match\n      const match = findMatchingFace(descriptor, faceData);\n      if (match) {\n        const {\n          user,\n          confidence\n        } = match;\n        console.log('Match found:', user.username, 'Confidence:', confidence);\n        setMatchConfidence(confidence);\n        setMatchedUser(user);\n        setFaceAuthStage('success');\n\n        // Stop video stream\n        if (streamRef.current) {\n          streamRef.current.getTracks().forEach(track => track.stop());\n        }\n\n        // After 2 seconds, redirect to home page\n        setTimeout(() => {\n          handleSuccessfulFaceLogin(user);\n        }, 2000);\n      } else {\n        setError('Face not recognized. Please try again or register if you are a new user.');\n        setFaceAuthStage('start');\n      }\n    } catch (err) {\n      console.error('Error during face matching:', err);\n      setError(`Authentication error: ${err.message}`);\n      setFaceAuthStage('start');\n    }\n  };\n\n  // Function to handle successful face login - simplified to use only username\n  const handleSuccessfulFaceLogin = matchedUser => {\n    var _location$state;\n    if (!matchedUser || !matchedUser.username) {\n      setError(\"Authentication failed. User data incomplete.\");\n      return;\n    }\n    console.log(\"Face authentication successful for:\", matchedUser.username);\n\n    // Store user session data in sessionStorage - simplified to username only\n    sessionStorage.setItem('authenticated', 'true');\n    sessionStorage.setItem('userId', matchedUser.userId || `user_${Date.now()}`);\n    sessionStorage.setItem('username', matchedUser.username);\n    sessionStorage.setItem('loginMethod', 'face');\n    sessionStorage.setItem('loginTime', new Date().toISOString());\n\n    // Optionally store some user data in localStorage for persistence\n    try {\n      localStorage.setItem('user', JSON.stringify({\n        userId: matchedUser.userId || `user_${Date.now()}`,\n        username: matchedUser.username,\n        role: 'user',\n        lastLogin: new Date().toISOString()\n      }));\n    } catch (e) {\n      console.warn(\"Could not save to localStorage:\", e);\n    }\n\n    // Use the proper location from useLocation()\n    const redirectTo = ((_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.redirectAfterLogin) || \"/\";\n    navigate(redirectTo);\n  };\n\n  // Function to cancel face auth and go back to start\n  const cancelFaceAuth = () => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n    }\n    if (detectionIntervalRef.current) {\n      clearInterval(detectionIntervalRef.current);\n    }\n    setFaceAuthStage('start');\n    setCameraReady(false);\n    setScanProgress(0);\n  };\n\n  // Function to retry face auth\n  const retryFaceAuth = () => {\n    cancelFaceAuth();\n    setTimeout(() => {\n      startFaceAuth();\n    }, 500);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"login-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"login-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Face Authentication Login\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"face-auth-container\",\n        children: [faceAuthStage === 'start' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"login-start-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"face-icon-container\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"face-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 285,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"login-instruction\",\n            children: \"Use facial recognition to login instantly\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"start-face-auth-btn\",\n            onClick: startFaceAuth,\n            disabled: !modelsLoaded,\n            children: modelsLoaded ? 'Start Face Authentication' : 'Loading...'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 290,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 13\n        }, this), faceAuthStage === 'scanning' && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"video-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              playsInline: true,\n              muted: true,\n              width: \"100%\",\n              height: \"100%\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 303,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              className: \"face-canvas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"scanning-overlay\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"scanning-animation\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 314,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"scan-status\",\n                children: \"Scanning your face...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 315,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"progress-container\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"progress-bar\",\n                  style: {\n                    width: `${scanProgress}%`\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 318,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 317,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 313,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"auth-action-buttons\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"retry-button\",\n              onClick: retryFaceAuth,\n              children: \"Retry\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 327,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"cancel-button\",\n              onClick: cancelFaceAuth,\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), faceAuthStage === 'success' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"video-container\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"auth-success-overlay\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"success-checkmark\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 340,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Authentication Successful\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 341,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Welcome back, \", matchedUser === null || matchedUser === void 0 ? void 0 : matchedUser.username]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 342,\n              columnNumber: 17\n            }, this), matchConfidence && /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Match confidence: \", formatMatchConfidence(matchConfidence)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"redirect-message\",\n              children: \"Redirecting you...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 346,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"alternative-auth\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Don't have an account?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"register-btn\",\n            onClick: () => navigate('/signup'),\n            children: \"Register\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 353,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 351,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 274,\n    columnNumber: 5\n  }, this);\n}\n_s(Login, \"Mdp/OdOc6HdC6Sj1Kp7WVBx4a7A=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = Login;\nexport default Login;\nvar _c;\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useLocation","faceapi","getAllFaceDescriptors","findMatchingFace","formatMatchConfidence","testCameraWithConstraints","jsxDEV","_jsxDEV","Fragment","_Fragment","Login","_s","error","setError","faceAuthStage","setFaceAuthStage","cameraReady","setCameraReady","modelsLoaded","setModelsLoaded","scanProgress","setScanProgress","matchConfidence","setMatchConfidence","matchedUser","setMatchedUser","videoRef","canvasRef","streamRef","detectionIntervalRef","navigate","location","loadModels","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","console","log","current","getTracks","forEach","track","stop","clearInterval","startFaceAuth","constraints","video","width","ideal","height","facingMode","testResult","success","Error","errorMessage","stream","navigator","mediaDevices","getUserMedia","srcObject","play","onloadedmetadata","detectFaces","err","message","detectionCount","requiredDetections","accumulatedDescriptor","setInterval","readyState","detections","detectSingleFace","TinyFaceDetectorOptions","withFaceLandmarks","withFaceDescriptor","progress","Math","min","descriptor","i","displaySize","matchDimensions","resizedDetection","resizeResults","context","getContext","clearRect","draw","drawDetections","matchFace","faceData","length","match","user","confidence","username","setTimeout","handleSuccessfulFaceLogin","_location$state","sessionStorage","setItem","userId","Date","now","toISOString","localStorage","JSON","stringify","role","lastLogin","e","warn","redirectTo","state","redirectAfterLogin","cancelFaceAuth","retryFaceAuth","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","ref","autoPlay","playsInline","muted","style","_c","$RefreshReg$"],"sources":["D:/Movies/Aniket/test2/test/src/Login.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport * as faceapi from 'face-api.js';\r\nimport './Login.css';\r\nimport { getAllFaceDescriptors } from './services/localFaceStorage';\r\nimport { findMatchingFace, formatMatchConfidence } from './utils/faceUtils';\r\nimport { testCameraWithConstraints } from './utils/cameraDebugger';\r\n\r\nfunction Login() {\r\n  // State hooks\r\n  const [error, setError] = useState(null);\r\n  const [faceAuthStage, setFaceAuthStage] = useState('start');\r\n  const [cameraReady, setCameraReady] = useState(false);\r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n  const [scanProgress, setScanProgress] = useState(0);\r\n  const [matchConfidence, setMatchConfidence] = useState(null);\r\n  const [matchedUser, setMatchedUser] = useState(null);\r\n  \r\n  // Refs\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n  const detectionIntervalRef = useRef(null);\r\n  \r\n  // Router hooks\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  \r\n  // Set up face detection on component mount\r\n  useEffect(() => {\r\n    const loadModels = async () => {\r\n      try {\r\n        // Set paths to models - adjust these paths according to your project structure\r\n        const MODEL_URL = process.env.PUBLIC_URL + '/models';\r\n        \r\n        await Promise.all([\r\n          faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n          faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n          faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)\r\n        ]);\r\n        \r\n        console.log('Face detection models loaded');\r\n        setModelsLoaded(true);\r\n      } catch (error) {\r\n        console.error('Error loading face-api models:', error);\r\n        setError('Failed to load facial recognition models. Please try again.');\r\n      }\r\n    };\r\n\r\n    loadModels();\r\n    \r\n    // Clean up on unmount\r\n    return () => {\r\n      if (streamRef.current) {\r\n        streamRef.current.getTracks().forEach(track => track.stop());\r\n      }\r\n      \r\n      if (detectionIntervalRef.current) {\r\n        clearInterval(detectionIntervalRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Function to handle face authentication\r\n  const startFaceAuth = async () => {\r\n    setError(null);\r\n    setFaceAuthStage('scanning');\r\n    \r\n    try {\r\n      // Request camera access\r\n      const constraints = {\r\n        video: {\r\n          width: { ideal: 640 },\r\n          height: { ideal: 480 },\r\n          facingMode: 'user'\r\n        }\r\n      };\r\n      \r\n      // Test camera with these constraints\r\n      const testResult = await testCameraWithConstraints(constraints);\r\n      if (!testResult.success) {\r\n        throw new Error(`Camera access failed: ${testResult.errorMessage || 'Unknown error'}`);\r\n      }\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n      streamRef.current = stream;\r\n      \r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        videoRef.current.play();\r\n        setCameraReady(true);\r\n        \r\n        // Start face detection after camera is ready\r\n        videoRef.current.onloadedmetadata = () => {\r\n          detectFaces();\r\n        };\r\n      }\r\n    } catch (err) {\r\n      console.error('Error starting camera:', err);\r\n      setError(`Camera access error: ${err.message || 'Unknown error'}. Please ensure your camera is connected and permissions are granted.`);\r\n      setFaceAuthStage('start');\r\n    }\r\n  };\r\n\r\n  // Function to detect faces\r\n  const detectFaces = () => {\r\n    if (!videoRef.current || !modelsLoaded) {\r\n      return;\r\n    }\r\n\r\n    // Clear any existing detection interval\r\n    if (detectionIntervalRef.current) {\r\n      clearInterval(detectionIntervalRef.current);\r\n    }\r\n\r\n    let detectionCount = 0;\r\n    const requiredDetections = 5;\r\n    let accumulatedDescriptor = null;\r\n\r\n    detectionIntervalRef.current = setInterval(async () => {\r\n      try {\r\n        if (videoRef.current && videoRef.current.readyState === 4) {\r\n          const detections = await faceapi.detectSingleFace(\r\n            videoRef.current, \r\n            new faceapi.TinyFaceDetectorOptions()\r\n          ).withFaceLandmarks().withFaceDescriptor();\r\n\r\n          if (detections) {\r\n            // Update progress\r\n            detectionCount++;\r\n            const progress = Math.min((detectionCount / requiredDetections) * 100, 100);\r\n            setScanProgress(progress);\r\n\r\n            // Accumulate descriptor for better accuracy\r\n            if (!accumulatedDescriptor) {\r\n              accumulatedDescriptor = detections.descriptor;\r\n            } else {\r\n              // Merge descriptors by averaging\r\n              for (let i = 0; i < 128; i++) {\r\n                accumulatedDescriptor[i] = (accumulatedDescriptor[i] * (detectionCount - 1) + detections.descriptor[i]) / detectionCount;\r\n              }\r\n            }\r\n\r\n            // Draw face detection on canvas if we have a canvas ref\r\n            if (canvasRef.current) {\r\n              const displaySize = { \r\n                width: videoRef.current.width, \r\n                height: videoRef.current.height \r\n              };\r\n              faceapi.matchDimensions(canvasRef.current, displaySize);\r\n              \r\n              const resizedDetection = faceapi.resizeResults(detections, displaySize);\r\n              const context = canvasRef.current.getContext('2d');\r\n              context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n              faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\r\n            }\r\n\r\n            // If we have enough detections, try to match face\r\n            if (detectionCount >= requiredDetections) {\r\n              clearInterval(detectionIntervalRef.current);\r\n              matchFace(accumulatedDescriptor);\r\n            }\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('Face detection error:', err);\r\n        clearInterval(detectionIntervalRef.current);\r\n        setError(`Face detection error: ${err.message}`);\r\n        setFaceAuthStage('start');\r\n      }\r\n    }, 500);\r\n  };\r\n\r\n  // Function to match detected face with stored faces\r\n  const matchFace = async (descriptor) => {\r\n    try {\r\n      // Get all stored face descriptors\r\n      const faceData = getAllFaceDescriptors();\r\n      \r\n      if (!faceData || faceData.length === 0) {\r\n        setError('No registered faces found. Please sign up first.');\r\n        setFaceAuthStage('start');\r\n        return;\r\n      }\r\n      \r\n      // Find a match\r\n      const match = findMatchingFace(descriptor, faceData);\r\n      \r\n      if (match) {\r\n        const { user, confidence } = match;\r\n        console.log('Match found:', user.username, 'Confidence:', confidence);\r\n        \r\n        setMatchConfidence(confidence);\r\n        setMatchedUser(user);\r\n        setFaceAuthStage('success');\r\n        \r\n        // Stop video stream\r\n        if (streamRef.current) {\r\n          streamRef.current.getTracks().forEach(track => track.stop());\r\n        }\r\n        \r\n        // After 2 seconds, redirect to home page\r\n        setTimeout(() => {\r\n          handleSuccessfulFaceLogin(user);\r\n        }, 2000);\r\n      } else {\r\n        setError('Face not recognized. Please try again or register if you are a new user.');\r\n        setFaceAuthStage('start');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error during face matching:', err);\r\n      setError(`Authentication error: ${err.message}`);\r\n      setFaceAuthStage('start');\r\n    }\r\n  };\r\n\r\n  // Function to handle successful face login - simplified to use only username\r\n  const handleSuccessfulFaceLogin = (matchedUser) => {\r\n    if (!matchedUser || !matchedUser.username) {\r\n      setError(\"Authentication failed. User data incomplete.\");\r\n      return;\r\n    }\r\n\r\n    console.log(\"Face authentication successful for:\", matchedUser.username);\r\n    \r\n    // Store user session data in sessionStorage - simplified to username only\r\n    sessionStorage.setItem('authenticated', 'true');\r\n    sessionStorage.setItem('userId', matchedUser.userId || `user_${Date.now()}`);\r\n    sessionStorage.setItem('username', matchedUser.username);\r\n    sessionStorage.setItem('loginMethod', 'face');\r\n    sessionStorage.setItem('loginTime', new Date().toISOString());\r\n    \r\n    // Optionally store some user data in localStorage for persistence\r\n    try {\r\n      localStorage.setItem('user', JSON.stringify({\r\n        userId: matchedUser.userId || `user_${Date.now()}`,\r\n        username: matchedUser.username,\r\n        role: 'user',\r\n        lastLogin: new Date().toISOString()\r\n      }));\r\n    } catch (e) {\r\n      console.warn(\"Could not save to localStorage:\", e);\r\n    }\r\n    \r\n    // Use the proper location from useLocation()\r\n    const redirectTo = location.state?.redirectAfterLogin || \"/\";\r\n    navigate(redirectTo);\r\n  };\r\n\r\n  // Function to cancel face auth and go back to start\r\n  const cancelFaceAuth = () => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach(track => track.stop());\r\n    }\r\n    \r\n    if (detectionIntervalRef.current) {\r\n      clearInterval(detectionIntervalRef.current);\r\n    }\r\n    \r\n    setFaceAuthStage('start');\r\n    setCameraReady(false);\r\n    setScanProgress(0);\r\n  };\r\n\r\n  // Function to retry face auth\r\n  const retryFaceAuth = () => {\r\n    cancelFaceAuth();\r\n    setTimeout(() => {\r\n      startFaceAuth();\r\n    }, 500);\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-container\">\r\n      <div className=\"login-card\">\r\n        <h2>Face Authentication Login</h2>\r\n        \r\n        {error && <div className=\"error-message\">{error}</div>}\r\n        \r\n        {/* Face Authentication UI */}\r\n        <div className=\"face-auth-container\">\r\n          {faceAuthStage === 'start' && (\r\n            <div className=\"login-start-section\">\r\n              <div className=\"face-icon-container\">\r\n                <div className=\"face-icon\"></div>\r\n              </div>\r\n              <p className=\"login-instruction\">\r\n                Use facial recognition to login instantly\r\n              </p>\r\n              <button \r\n                className=\"start-face-auth-btn\"\r\n                onClick={startFaceAuth}\r\n                disabled={!modelsLoaded}\r\n              >\r\n                {modelsLoaded ? 'Start Face Authentication' : 'Loading...'}\r\n              </button>\r\n            </div>\r\n          )}\r\n          \r\n          {faceAuthStage === 'scanning' && (\r\n            <>\r\n              <div className=\"video-container\">\r\n                <video\r\n                  ref={videoRef}\r\n                  autoPlay\r\n                  playsInline\r\n                  muted\r\n                  width=\"100%\"\r\n                  height=\"100%\"\r\n                />\r\n                <canvas ref={canvasRef} className=\"face-canvas\" />\r\n                \r\n                <div className=\"scanning-overlay\">\r\n                  <div className=\"scanning-animation\"></div>\r\n                  <p className=\"scan-status\">Scanning your face...</p>\r\n                  \r\n                  <div className=\"progress-container\">\r\n                    <div \r\n                      className=\"progress-bar\" \r\n                      style={{ width: `${scanProgress}%` }}\r\n                    ></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"auth-action-buttons\">\r\n                <button className=\"retry-button\" onClick={retryFaceAuth}>\r\n                  Retry\r\n                </button>\r\n                <button className=\"cancel-button\" onClick={cancelFaceAuth}>\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </>\r\n          )}\r\n          \r\n          {faceAuthStage === 'success' && (\r\n            <div className=\"video-container\">\r\n              <div className=\"auth-success-overlay\">\r\n                <div className=\"success-checkmark\"></div>\r\n                <h3>Authentication Successful</h3>\r\n                <p>Welcome back, {matchedUser?.username}</p>\r\n                {matchConfidence && (\r\n                  <p>Match confidence: {formatMatchConfidence(matchConfidence)}</p>\r\n                )}\r\n                <p className=\"redirect-message\">Redirecting you...</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          <div className=\"alternative-auth\">\r\n            <p>Don't have an account?</p>\r\n            <button \r\n              className=\"register-btn\"\r\n              onClick={() => navigate('/signup')}\r\n            >\r\n              Register\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Login;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}